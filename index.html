<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CitrusAPP</title>

    <!-- HOJAS DE ESTILO (CSS) -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.prod.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        --q-primary: #f97316;
      }
      body {
        transition: background-color 0.3s, color 0.3s;
      }
    </style>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900">
    <div id="q-app">
      <q-layout view="hHh Lpr lFf">
        <q-header elevated class="bg-primary text-white">
          <q-toolbar>
            <q-btn
              dense
              flat
              round
              icon="menu"
              @click="toggleLeftDrawer"
            ></q-btn>
            <q-toolbar-title>
              <q-avatar class="mr-2">
                <img src="logo_citrus.png" alt="Logo CitrusAPP" />
              </q-avatar>
              CitrusAPP
            </q-toolbar-title>
            <q-space></q-space>
            <q-toggle
              v-model="darkMode"
              checked-icon="dark_mode"
              unchecked-icon="light_mode"
              color="white"
              @update:model-value="toggleDarkMode"
            ></q-toggle>
          </q-toolbar>
        </q-header>

        <q-drawer v-model="leftDrawerOpen" side="left" bordered>
          <q-list>
            <q-item-label header>Módulos</q-item-label>
            <q-item clickable v-ripple @click="currentView = 'ingresoFruta'"
              ><q-item-section avatar
                ><q-icon name="apple"></q-icon></q-item-section
              ><q-item-section>Ingreso de Fruta</q-item-section></q-item
            >
            <q-item clickable v-ripple @click="currentView = 'productores'"
              ><q-item-section avatar
                ><q-icon name="people"></q-icon></q-item-section
              ><q-item-section>Productores</q-item-section></q-item
            >
            <q-item clickable v-ripple @click="currentView = 'usuarios'"
              ><q-item-section avatar
                ><q-icon name="manage_accounts"></q-icon></q-item-section
              ><q-item-section>Usuarios</q-item-section></q-item
            >
          </q-list>
        </q-drawer>

        <q-page-container>
          <div class="p-4 sm:p-6 md:p-8">
            <!-- Módulo Ingreso de Fruta -->
            <div v-if="currentView === 'ingresoFruta'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Ingreso de Fruta
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Ingreso"
                class="mb-4"
              />
              <q-table
                title="Ingresos Recientes"
                :rows="ingresosFruta"
                :columns="[{ name: 'ticket', label: 'N° Ticket', field: 'ticket' }, { name: 'productor', label: 'Productor', field: 'productor' }, { name: 'fechaIngreso', label: 'Fecha Ingreso', field: 'fechaIngreso' }, { name: 'pesoNeto', label: 'Peso Neto', field: 'pesoNeto' }]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>

            <!-- Módulo Productores -->
            <div v-if="currentView === 'productores'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Gestión de Productores
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Productor"
                class="mb-4"
              />
              <q-table
                title="Productores"
                :rows="productores"
                :columns="[{ name: 'nombre', label: 'Nombre', field: 'nombre', align: 'left' }, { name: 'cuit', label: 'CUIT', field: 'cuit' }, { name: 'ubicacion', label: 'Ubicación', field: 'ubicacion' }]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>

            <!-- Módulo Usuarios -->
            <div v-if="currentView === 'usuarios'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Gestión de Usuarios
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Usuario"
                class="mb-4"
              />
              <q-table
                title="Usuarios del Sistema"
                :rows="usuarios"
                :columns="[{ name: 'nombre', label: 'Apellido y Nombre', field: 'nombre' }, { name: 'usuario', label: 'Usuario', field: 'usuario' }, { name: 'email', label: 'Email', field: 'email' }, { name: 'rol', label: 'Rol', field: 'rol' }]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>
          </div>
        </q-page-container>
      </q-layout>
    </div>

    <!-- SCRIPTS -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.umd.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>

    <script>
      const { createApp, ref, onMounted } = Vue;

      const app = createApp({
        setup() {
          // --- URL DE TU API DESPLEGADA EN RENDER ---
          // !!! ASEGÚRATE DE QUE ESTA ES LA URL CORRECTA QUE TE DIO RENDER !!!
          const API_URL = "https://citrusapp-backend.onrender.com";

          // --- Estado General de la App ---
          const leftDrawerOpen = ref(false);
          const darkMode = ref(false);
          const currentView = ref("productores"); // Iniciamos en productores para ver el resultado

          // --- Estado de los Datos (INICIAN VACÍOS) ---
          const productores = ref([]);
          const usuarios = ref([]);
          const ingresosFruta = ref([]);

          // --- Función para Cargar Datos de la API ---
          const cargarProductores = async () => {
            try {
              const response = await fetch(`${API_URL}/api/productores`);
              if (!response.ok) {
                throw new Error("La respuesta de la red no fue OK");
              }
              const data = await response.json();
              productores.value = data; // Rellenamos el array con los datos reales
            } catch (error) {
              console.error("Falló la carga de productores:", error);
            }
          };

          // --- Hook de Ciclo de Vida ---
          onMounted(() => {
            cargarProductores();
            // Aquí en el futuro llamaremos a cargarUsuarios(), cargarIngresos(), etc.
          });

          // --- Funciones de la UI ---
          const toggleLeftDrawer = () => {
            leftDrawerOpen.value = !leftDrawerOpen.value;
          };
          const toggleDarkMode = (value) => {
            Quasar.Dark.set(value);
          };

          // Retornamos todo lo que el template HTML necesita
          return {
            leftDrawerOpen,
            darkMode,
            currentView,
            toggleLeftDrawer,
            toggleDarkMode,
            productores,
            usuarios,
            ingresosFruta,
          };
        },
      });

      app.use(Quasar);
      app.mount("#q-app");
    </script>
  </body>
</html>
