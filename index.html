<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CitrusAPP</title>

    <!-- HOJAS DE ESTILO (CSS) VAN EN EL HEAD -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.prod.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Estilos personalizados y sobreescritura de Quasar/Flowbite */
      :root {
        --q-primary: #f97316;
      }
      /* Para que la transición de color sea más suave */
      body {
        transition: background-color 0.3s, color 0.3s;
      }
    </style>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900">
    <!-- El div de la app es lo primero en el body -->
    <div id="q-app">
      <q-layout view="hHh Lpr lFf">
        <q-header elevated class="bg-primary text-white">
          <q-toolbar>
            <q-btn
              dense
              flat
              round
              icon="menu"
              @click="toggleLeftDrawer"
            ></q-btn>
            <q-toolbar-title>
              <q-avatar class="mr-2">
                <!-- Asegúrate de tener un archivo logo_citrus.png en la misma carpeta -->
                <img src="logo_citrus.png" alt="Logo CitrusAPP" />
              </q-avatar>
              CitrusAPP
            </q-toolbar-title>
            <q-space></q-space>
            <q-toggle
              v-model="darkMode"
              checked-icon="dark_mode"
              unchecked-icon="light_mode"
              color="white"
              @update:model-value="toggleDarkMode"
            ></q-toggle>
          </q-toolbar>
        </q-header>

        <q-drawer v-model="leftDrawerOpen" side="left" bordered>
          <q-list>
            <q-item-label header>Módulos</q-item-label>
            <q-item clickable v-ripple @click="currentView = 'ingresoFruta'">
              <q-item-section avatar>
                <q-icon name="apple"></q-icon>
              </q-item-section>
              <q-item-section> Ingreso de Fruta </q-item-section>
            </q-item>
            <q-item clickable v-ripple @click="currentView = 'productores'">
              <q-item-section avatar>
                <q-icon name="people"></q-icon>
              </q-item-section>
              <q-item-section> Productores </q-item-section>
            </q-item>
            <q-item clickable v-ripple @click="currentView = 'usuarios'">
              <q-item-section avatar>
                <q-icon name="manage_accounts"></q-icon>
              </q-item-section>
              <q-item-section> Usuarios </q-item-section>
            </q-item>
          </q-list>
        </q-drawer>

        <q-page-container>
          <div class="p-4 sm:p-6 md:p-8">
            <!-- Módulo Ingreso de Fruta -->
            <div v-if="currentView === 'ingresoFruta'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Ingreso de Fruta
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Ingreso"
                class="mb-4"
              />
              <q-table
                title="Ingresos Recientes"
                :rows="ingresosFruta"
                :columns="[
                            { name: 'ticket', label: 'N° Ticket', field: 'ticket', sortable: true },
                            { name: 'productor', label: 'Productor', field: 'productor', align: 'left', sortable: true },
                            { name: 'fechaIngreso', label: 'Fecha Ingreso', field: 'fechaIngreso', sortable: true },
                            { name: 'pesoNeto', label: 'Peso Neto', field: 'pesoNeto' }
                          ]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>

            <!-- Módulo Productores -->
            <div v-if="currentView === 'productores'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Gestión de Productores
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Productor"
                class="mb-4"
              />
              <q-table
                title="Productores"
                :rows="productores"
                :columns="[
                            { name: 'nombre', label: 'Nombre', field: 'nombre', align: 'left', sortable: true },
                            { name: 'cuit', label: 'CUIT', field: 'cuit', sortable: true },
                            { name: 'ubicacion', label: 'Ubicación', field: 'ubicacion' }
                          ]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>

            <!-- Módulo Usuarios -->
            <div v-if="currentView === 'usuarios'">
              <h1 class="text-2xl font-bold mb-4 dark:text-white">
                Gestión de Usuarios
              </h1>
              <q-btn
                color="primary"
                icon="add"
                label="Nuevo Usuario"
                class="mb-4"
              />
              <q-table
                title="Usuarios del Sistema"
                :rows="usuarios"
                :columns="[
                            { name: 'nombre', label: 'Apellido y Nombre', field: 'nombre', align: 'left', sortable: true },
                            { name: 'usuario', label: 'Usuario', field: 'usuario', sortable: true },
                            { name: 'email', label: 'Email', field: 'email', align: 'left' },
                            { name: 'rol', label: 'Rol', field: 'rol' }
                          ]"
                row-key="id"
                :dark="darkMode"
                class="shadow-md"
              ></q-table>
            </div>
          </div>
        </q-page-container>
      </q-layout>
    </div>

    <!-- SCRIPTS DE JAVASCRIPT AL FINAL DEL BODY -->

    <!-- 1. Cargar Vue -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- 2. Cargar Quasar -->
    <script src="https://cdn.jsdelivr.net/npm/quasar@2.12.0/dist/quasar.umd.prod.js"></script>

    <!-- 3. Cargar Flowbite (Opcional, para componentes adicionales) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>

    <!-- 4. TU CÓDIGO de la aplicación, al final de todo -->
    <script>
      const { createApp, ref, reactive } = Vue;

      const app = createApp({
        setup() {
          // --- Estado General de la App ---
          const leftDrawerOpen = ref(false);
          const darkMode = ref(false);
          const currentView = ref("ingresoFruta"); // Vista que se muestra al inicio

          // --- Datos Falsos (Mock Data) ---
          const productores = reactive([
            {
              id: 1,
              nombre: "Finca El Naranjal S.A.",
              cuit: "30-12345678-9",
              ubicacion: "Tucumán",
            },
            {
              id: 2,
              nombre: "Citrus del Norte S.R.L.",
              cuit: "30-87654321-1",
              ubicacion: "Salta",
            },
            {
              id: 3,
              nombre: "Limoneros de Jujuy",
              cuit: "30-11223344-5",
              ubicacion: "Jujuy",
            },
          ]);

          const usuarios = reactive([
            {
              id: 1,
              nombre: "Juan Perez",
              email: "juan@email.com",
              usuario: "jperez",
              rol: "Admin",
            },
            {
              id: 2,
              nombre: "Ana Gomez",
              email: "ana@email.com",
              usuario: "agomez",
              rol: "Operador",
            },
          ]);

          const ingresosFruta = reactive([
            {
              id: 1,
              ticket: "T-001",
              productor: "Finca El Naranjal S.A.",
              fechaIngreso: "2025-09-21 10:00",
              pesoNeto: "22,500 kg",
            },
            {
              id: 2,
              ticket: "T-002",
              productor: "Citrus del Norte S.R.L.",
              fechaIngreso: "2025-09-21 11:30",
              pesoNeto: "24,100 kg",
            },
          ]);

          // --- Funciones ---
          const toggleLeftDrawer = () => {
            leftDrawerOpen.value = !leftDrawerOpen.value;
          };

          const toggleDarkMode = (value) => {
            // El 'value' lo recibe directamente del componente q-toggle
            Quasar.Dark.set(value);
          };

          // Retornamos todo lo que el template HTML necesita usar
          return {
            leftDrawerOpen,
            darkMode,
            currentView,
            toggleLeftDrawer,
            toggleDarkMode,
            productores,
            usuarios,
            ingresosFruta,
          };
        },
      });

      // Le decimos a Vue que use el plugin de Quasar
      app.use(Quasar);

      // Montamos la aplicación de Vue en el div #q-app
      app.mount("#q-app");
    </script>
  </body>
</html>
